<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:paz="using:Avalonia.Controls.PanAndZoom"
             xmlns:viewModels="clr-namespace:Jaguar.Desktop.ViewModels"
             xmlns:nodes="clr-namespace:Jaguar.Desktop.CustomViews.Nodes"
             xmlns:models="clr-namespace:Jaguar.Desktop.Models"
             x:DataType="viewModels:CanvasViewModel"
             x:Class="Jaguar.Desktop.Views.CanvasView">
    
    <Grid>
        <paz:ZoomBorder Name="ZoomBorder" 
                        Stretch="None" 
                        ZoomSpeed="1.2" 
                        PanButton="Right"
                        EnableZoom="True"
                        Focusable="True"
                        DoubleTapped="ZoomBorder_OnDoubleTapped"
                        PointerMoved="ZoomBorder_OnPointerMoved"
                        PointerExited="ZoomBorder_OnPointerExited"
                        EnableGestureZoom="True"
                        EnablePan="True"
                        ClipToBounds="True"
                        VerticalAlignment="Stretch" 
                        HorizontalAlignment="Stretch">

            <Panel
                Name="ContentPanel"
                Width="1000"
                Height="1000"
               >
                
                <Panel.Background>
                    <VisualBrush TileMode="Tile" SourceRect="0,0,40,40" DestinationRect="0,0,40,40">
                        <VisualBrush.Visual>
                            <Canvas Width="40" Height="40">
                                <Ellipse Width="1.5" Height="1.5" Fill="#252525" Canvas.Left="0" Canvas.Top="0"/>
                            </Canvas>
                        </VisualBrush.Visual>
                    </VisualBrush>
                </Panel.Background>

                <ItemsControl ItemsSource="{Binding CurrentScope.Children}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas Background="Transparent" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.Styles>
                        <Style Selector="ItemsControl > ContentPresenter" x:DataType="models:FlowNode">
                            <Setter Property="Canvas.Left" Value="{Binding X, Mode=TwoWay}" />
                            <Setter Property="Canvas.Top" Value="{Binding Y, Mode=TwoWay}" />
                        </Style>
                        <Style Selector="ItemsControl > ContentPresenter:pointerover">
                            <Setter Property="ZIndex" Value="99"/>
                        </Style>
                    </ItemsControl.Styles>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:FlowNode">
                            <nodes:AgentNodeView />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Panel>
        </paz:ZoomBorder>

        <StackPanel ZIndex="50" VerticalAlignment="Top" HorizontalAlignment="Center" Spacing="10" Margin="20">
            <Button Content="î„’ Back to Parent" 
                    IsVisible="{Binding CurrentScope.Parent}"
                    Foreground="White"
                    Command="{Binding NavigateUp}"
                    Background="#CC000000"
                    Padding="15,7" />
            
            <Border Background="#CC000000" CornerRadius="5" Padding="10,5" HorizontalAlignment="Center">
                <TextBlock Text="{Binding CurrentScope.Title}" 
                           FontSize="14" 
                           FontWeight="SemiBold" 
                           Foreground="LightGray"/>
            </Border>
        </StackPanel>
    </Grid>
</UserControl>